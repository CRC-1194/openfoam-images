FROM archlinux

# TODO: Install ptscotch, it's not available with pacman. 
RUN pacman -Syyu --noconfirm git gcc openmpi base-devel flex bison boost boost-libs curl
# Build OpenFOAM in /opt
RUN mkdir "/opt/OpenFOAM/" 
WORKDIR "/opt/OpenFOAM"
# Clone openfoam from gitlab, checkout the git tag OpenFOAM-v2012 and rename the folder.
RUN git clone https://develop.openfoam.com/Development/openfoam.git && cd openfoam && git checkout OpenFOAM-v2012 && cd .. && mv openfoam OpenFOAM-v2012 
# Download Third-Party
RUN curl -L https://sourceforge.net/projects/openfoam/files/v2012/ThirdParty-v2012.tgz > ThirdParty-v2012.tgz
RUN tar -xzf ThirdParty-v2012.tgz
WORKDIR "/opt/OpenFOAM/ThirdParty-v2012"
RUN source /opt/OpenFOAM/OpenFOAM-v2012/etc/bashrc && echo $WM_THIRD_PARTY_DIR && ./Allwmake
WORKDIR "/opt/OpenFOAM/OpenFOAM-v2012"
# Initialize and update the submodules, compile everything. 
RUN git submodule init && git submodule update
RUN ls -l src/OSspecific/POSIX/Make && ./Allwmake
